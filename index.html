<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Screening Test Checker</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#007bff">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icon.png">
<style>
html,body{height:100%;margin:0;padding:0;overflow:auto}
body{font-family:Arial,sans-serif;padding:10px;background:#f2f4f7}
h1{font-size:20px;text-align:center;margin-bottom:8px}
.card{background:#fff;border-radius:6px;padding:8px;box-shadow:0 2px 5px rgba(0,0,0,0.08);max-width:500px;margin:8px auto}
.row{margin-bottom:6px}
label{font-size:13px;font-weight:bold;display:block;margin-bottom:2px}
select,input[type=number],button{width:100%;font-size:13px;padding:6px;border-radius:4px;border:1px solid #ccc;box-sizing:border-box}
button{background:#007bff;color:#fff;border:none;font-weight:bold;cursor:pointer;padding:8px}
button:hover{background:#0056b3}
.divider{height:1px;background:#eee;margin:6px 0}
#result{margin-top:8px;font-size:13px;background:#fff;padding:8px;border-radius:6px;box-shadow:0 2px 5px rgba(0,0,0,0.05)}
ul{padding-left:16px;margin:0}
.stats-card{background:#fff;border-radius:6px;padding:6px;box-shadow:0 2px 5px rgba(0,0,0,0.08);max-width:500px;margin:8px auto;text-align:center;font-size:13px;font-weight:bold}
@media(min-width:600px){
  h1{font-size:22px}
  select,input[type=number],button{font-size:14px}
  #result{font-size:14px}
  .stats-card{font-size:14px}
}
</style>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
<h1>Screening Test Checker</h1>

<div class="card">
  <div class="row">
    <label for="gender">Gender:</label>
    <select id="gender">
      <option value="Male">Male</option>
      <option value="Female">Female</option>
    </select>
  </div>
  <div class="row">
    <label for="age">Age:</label>
    <input type="number" id="age" min="0" max="120" placeholder="Enter age">
  </div>
  <div class="row">
    <button onclick="checkTests()">Check Eligible Tests</button>
  </div>
</div>

<div id="result" class="card" style="display:none"></div>

<div class="stats-card">
  Visits: <span id="visitCount">0</span> | Checks: <span id="checkCount">0</span>
</div>

<script>
// ===== Firebase config =====
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT.firebaseio.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "XXX",
  appId: "XXX"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ===== Elements =====
let visitCountElem = document.getElementById("visitCount");
let checkCountElem = document.getElementById("checkCount");

// ===== Offline storage =====
let pendingVisits = parseInt(localStorage.getItem("pendingVisits") || 0);
let pendingChecks = parseInt(localStorage.getItem("pendingChecks") || 0);

// ===== Update UI =====
function updateCountersUI(visits, checks){
  if(visits!==null) visitCountElem.innerText = visits;
  if(checks!==null) checkCountElem.innerText = checks;
}

// ===== Sync pending offline counts to Firebase =====
function syncOfflineCounts(){
  if(!navigator.onLine) return; // only when online
  db.ref('counters').once('value').then(snapshot=>{
    let data = snapshot.val() || {visits:0, checks:0};
    data.visits += pendingVisits;
    data.checks += pendingChecks;
    db.ref('counters').set(data);
    updateCountersUI(data.visits, data.checks);
    pendingVisits = 0;
    pendingChecks = 0;
    localStorage.setItem("pendingVisits", 0);
    localStorage.setItem("pendingChecks", 0);
  });
}

// ===== Increment visit on page load =====
function incrementVisit(){
  if(navigator.onLine){
    db.ref('counters/visits').transaction(current=>{
      return (current||0)+1;
    });
    syncOfflineCounts();
  } else {
    pendingVisits++;
    localStorage.setItem("pendingVisits", pendingVisits);
  }
  updateCountersUI(null, null);
}
incrementVisit();

// ===== Check tests function =====
function checkTests(){
  var g = document.getElementById("gender").value,
      a = parseInt(document.getElementById("age").value),
      r = document.getElementById("result");
  if(isNaN(a)){ r.style.display="block"; r.innerHTML="Please enter a valid age."; return }
  
  var t = [];
  if(a>=18&&a<=39)t.push("Major package (18-39)");
  if(a>=40&&a<=64)t.push("Major package (40-64)");
  if(a>=65&&a<=75)t.push("Major package (65-75)");
  if(a>=50&&a<=64)t.push("Hearing and Dementia (50-64)");
  if(a>=65&&a<=75)t.push("Hearing and Dementia (65-75)");
  if(a>=60&&a<=75)t.push("Dexa scan (60-75)");
  if(a>=40&&a<=75)t.push("FIT test (40-75)");
  if(a>=18&&a<=75)t.push("Oral health (18-75)");
  if(a>=65&&a<=75)t.push("Vision screening (65-75)");
  if(g.toLowerCase()==="male"){
    if(a>=20&&a<=35)t.push("Reproductive (20-35)");
    if(a>=65&&a<=75)t.push("AAA (65-75)");
  }
  if(g.toLowerCase()==="female"){
    if(a>=20&&a<=34)t.push("Breast cancer (20-34)");
    if(a>=35&&a<=39)t.push("Breast cancer with Gail (35-39)");
    if(a>=40&&a<=75)t.push("Mammo (40-75)");
    if(a>=20&&a<=35)t.push("Reproductive (20-35)");
    if(a>=25&&a<=29)t.push("Cervical cancer (25-29)");
    if(a>=30&&a<=65)t.push("Cervical cancer, PCSP (30-65)");
  }
  
  r.style.display = "block";
  if(t.length===0) r.innerHTML="No tests found for the given criteria.";
  else{
    var h="<h2 style='font-size:14px;margin:0 0 4px'>Eligible tests for "+g+" aged "+a+":</h2><ul>";
    t.forEach(function(x){h+="<li>"+x+"</li>"});
    h+="</ul>";
    r.innerHTML = h;
  }

  // Increment check counter
  if(navigator.onLine){
    db.ref('counters/checks').transaction(current=>(current||0)+1);
    syncOfflineCounts();
  } else {
    pendingChecks++;
    localStorage.setItem("pendingChecks", pendingChecks);
  }
  updateCountersUI(null,null);
}

// ===== Online event to sync offline counts =====
window.addEventListener('online', syncOfflineCounts);

// ===== Service Worker =====
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js').then(()=>console.log('Service Worker Registered'));
}
</script>
</body>
</html>

